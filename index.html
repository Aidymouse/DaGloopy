<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="main.css" />
    <link rel="stylesheet" href="css/desk.css" />
    <link rel="stylesheet" href="css/shelf.css" />
    <link rel="stylesheet" href="css/viewer.css" />

    <script type="module" src="./js/shelf.js"></script>
    <script type="module" src="./js/viewer.js"></script>
    <script src="./js/showdown.min.js"></script>

    <script type="module">
      import { process_markdown } from "./js/markdown.js";

      import { load_article, book_pointerup } from "./js/shelf.js";
      import { initiate_viewer, close_viewer } from "./js/viewer.js";

      window.book_pointerup = book_pointerup;
      window.close_viewer = close_viewer;

      /**
       * GLOBAL STATE
       **/
      // Element reference to a book currently being viewed
      globalThis.viewed_book = null;
      // Transformation timer indicating time taken to animate books flying out. Matched by a css var
      globalThis.trans = 0.4;
      // Book currently being dragged around the shelf
      globalThis.dragged_book = null;

      /**
       * VIEWER CODE
       **/
    </script>
  </head>

  <body>
    <main
      class="screen"
      id="desk_view"
      ondrop="desk_view_drop(event)"
      ondragover="desk_view_dragover(event)"
    >
      <!-- THE DESK -->
      <section
        id="desktop"
        ondragover="desk_dragover(event)"
        ondrop="desktop_drop(event)"
      >
        <article
          draggable="true"
          ondragstart="article_ondragstart(event)"
          ondragend="article_ondragend(event)"
        >
          <h2>Test</h2>
          <p>This is the context of test two. Not the summary! Lololol.</p>
        </article>
      </section>

      <nav height="5em">
        <button onclick="go_to_shelf_view()">To Shelf</button>
      </nav>
    </main>

    <!-- THE SHELF -->
    <main class="screen" id="shelf_view">
      <nav id="shelftop">
        <section id="shelftop-content">
          <button onclick="go_to_desk_view()">To Desk</button>
        </section>
      </nav>

      <section id="shelf">
        <div class="shelf-seperator"></div>
        <section class="shelf-bay">
          <!-- Code populated start -->
          <article
            class="book"
            draggable="true"
            ondragstart="book_dragstart(event)"
            ondragend="book_dragend(event)"
            onpointerup="book_pointerup(event)"
            data-contenturl="content/dagloopyrpg/12 room dungeon blocks.md"
            data-title="12 Room Dungeon Blocks"
          >
            <h2>12 Room Dungeon Blocks</h2>
          </article>

          <article
            class="book"
            draggable="true"
            ondragstart="book_dragstart(event)"
            ondragend="book_dragend(event)"
            onpointerup="book_pointerup(event)"
            data-contenturl="content/dagloopyrpg/birthright, mausritter, rules light warfare.md"
            data-title="Birthright, Mausritter, Rules Light Warfare"
          >
            <h2>Birthright, Mausritter, Rules Light Warfare</h2>
          </article>

          <!-- Code populated end -->
        </section>

        <div class="shelf-seperator"></div>
        <section class="shelf-bay"></section>
        <div class="shelf-seperator"></div>
        <section class="shelf-bay"></section>
        <div class="shelf-seperator"></div>

        <!-- Used to make the illusion of the book flying back into place -->
      </section>

      <section
        id="desk-drop-zone"
        ondragenter="enter_drop_zone(event)"
      ></section>

      <!-- TODO: give this events so the shelf is still responsive -->
      <section id="floating_book"></section>
    </main>

    <template id="article-nav">
      <nav>
        <button onclick="close_viewer()">Back</button>
      </nav>
    </template>

    <main class="screen" id="viewer_view">
      <section id="floating_loader">
        <nav class="viewer-nav">
          <button onclick="close_viewer()">Back</button>
        </nav>
        <article id="mock_article_content" class="article_content"></article>
        <nav class="viewer-nav">
          <button onclick="close_viewer()">Back</button>
        </nav>
      </section>

      <section id="viewed_article">
        <nav>
          <button onclick="close_viewer()">Back</button>
        </nav>
        <article id="viewed_article_content" class="article_content"></article>
        <nav>
          <button onclick="close_viewer()">Back</button>
        </nav>
      </section>
    </main>
  </body>
</html>
